#!/bin/bash

# Încearcă să activeze venv-ul din directorul părintelui (calea relativă)
if [ -f "../.venv/bin/activate" ]; then
    . ../.venv/bin/activate
    echo "Venv activat din directorul părinte"
elif [ -f ".venv/bin/activate" ]; then
    . ./.venv/bin/activate
    echo "Venv activat din directorul curent"
else
    # Crează un nou venv dacă nu există
    echo "Creez un nou venv pentru Jenkins"
    python3 -m venv .venv_jenkins
    . ./.venv_jenkins/bin/activate
    pip install -r requirements.txt
fi

# Comenzi pentru debugging
echo "Current directory: $(pwd)"
echo "Files in current directory: $(ls -la)"
echo "Shell being used: $SHELL"
echo "Python path: $(which python)"
echo "Python version: $(python --version)"

# Verifică dacă venv-ul este activat corect
if python -c "import sys; print(sys.prefix)" | grep -q "venv"; then
    echo "SUCCESS: venv was activated."
else
    echo "FAIL: venv was not activated properly."
    exit 1
fi